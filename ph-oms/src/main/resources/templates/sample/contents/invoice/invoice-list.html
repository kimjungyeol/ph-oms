<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="sample/layouts/default-layout">
<th:block layout:fragment="content">
    <div class="container">
        <!-- 검색 영역 -->
        <div class="search-box be-light border mb-1">
            <form class="form-horizontal form-search m-1">
                <div class="row" data-trigger="form">
                    <!-- <div class="row col-md-4">
                        <label class="col-md-4 col-form-label"> 인보이스일자 </label>
                        <div class="col-md-8">
                            <div class="input-group">
                                <input class="form-control" type="date" max="9999-12-31" placeholder="YYYY-MM-DD" id="beginDate" name="beginDate"/>
                                <input class="form-control" type="date" max="9999-12-31" placeholder="YYYY-MM-DD" id="endDate" name="endDate"/>
                            </div>
                        </div>
                    </div> -->
                    <div class="row col-md-4">
                        <label class="col-md-4 col-form-label"> 인보이스일자 </label>
                        <div class="col-md-8">
                            <div data-component-datepicker="range" id="invoiceDate" style="width: 100px;"></div>
                        </div>    
                    </div>
                    <div class="row col-md-4">
                        <label class="col-md-4 col-form-label"> 인보이스번호 </label>
                        <div class="col-md-8">
                            <input type="text" class="form-control" placeholder="인보이스번호" id="invoiceNo" name="invoiceNo"/>
                        </div>
                    </div>
                    <div class="row col-md-4">
                        <label class="col-md-4 col-form-label"> 목적국 </label>
                        <div class="col-md-8">
                            <input type="text" class="form-control" placeholder="2자리만 입력하세요." title="2자리만 입력하세요" maxlength="2" id="destNationCode" name="destNationCode"/>
                        </div>
                    </div>
                    <div class="row col-md-4">
                        <label class="col-md-4 col-form-label"> 협정 </label>
                        <div class="col-md-8">
                            <select class="form-select" id ="ftaId" name="ftaId">
                                <option value="">전체</option>
                            </select>
                        </div>
                    </div>
                    <div class="row col-md-4">
                        <label class="col-md-4 col-form-label"> 상태 </label>
                        <div class="col-md-8">
                            <select class="form-select" id="status" name="status">
                                <option value="">전체</option>
                            </select>
                        </div>
                    </div>
                    <div class="row col-md-4">
                        <label class="col-md-4 col-form-label"> 수하인 </label>
                        <div class="col-md-8">
                            <input type="text" class="form-control" placeholder="수하인" id="customerName" name="customerName"/>
                        </div>
                    </div>
                </div>
            </form>
        </div>
        
        <!-- 버튼 영역 -->
        <div class="d-flex justify-content-end" data-trigger="button">
            <div class="btn-group p-1 mr-1" role="group">
                <button class="btn btn-outline-info" id="judgmentBtn">
                    <i class="fa fa-th-large"></i>선택일괄판정
                </button>
                <button class="btn btn-outline-danger" id="deleteBtn">
                    <i class="fa fa-trash"></i>삭제
                </button>
                <!-- <button class="btn btn-outline-success" id="issueBtn">
                        <i class="fa fa-edit"></i>원산지증명서 작성
                </button> -->
                <div class="dropdown">
                    <button class="btn btn-outline-success" id="issueBtn" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fa fa-edit"></i>원산지증명서 작성
                    </button>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                        <a class="dropdown-item" href="#">상공회의소</a>
                        <a class="dropdown-item" href="#">관세청</a>
                        <a class="dropdown-item" href="#">자율발급</a>
                    </div>
                </div>
            </div>

            <div class="btn-group p-1" role="group">
                <button type="button" class="btn btn-outline-info" id="downloadBtn">
                    <i class="fas fa-download"></i>다운로드
                </button>
                <button type="button" class="btn btn-outline-success" id="searchBtn">
                    <i class="fas fa-search"></i>검색
                </button>
                <button type="button" class="btn btn-outline-secondary" id="initBtn">
                    <i class="fas fa-sync"></i>초기화
                </button>
            </div>
        </div>
        
        <!-- 그리드 영역 -->
        <div class="mt-2" id="invoiceGrid"></div>
        
    </div>

    <script th:inline="javascript">
        'use strict';
        // 1.page init area.
        ;(function(co, fn, grid) {
        	let today = new Date();
            let year = today.getFullYear();
            let month = ('0' + (today.getMonth() + 1)).slice(-2);
            let day = ('0' + today.getDate()).slice(-2);
            let beginDateStr = month + '-' + day + '-' + (year - 1);
            let endDateStr = month + '-' + day + '-' + year;
        	
        	co.initParams = {
    			start_invoiceDate: beginDateStr,
    			end_invoiceDate: endDateStr,
        	};
        	
            //fn.form.setData(co.initParams);
            
            co.uriMap = {
                judgment: '/sample/invoice/list/judgment',
                delete: '/sample/invoice/list/delete',
                issue: '/sample/invoice/list/issue',
                search: '/sample/invoice/list/search',
            }
            
            co.moveMap = {
                detail: '/sample/contents/invoice/invoice-detail',
            }
            
            grid.id = {
                grid: 'invoiceGrid',
            }
            
            //grid js include.
            co.require(['./grid/grid-invoice.js']);
            
        })(wg.c, wg.f, wg.gr);
        
        // 2.function area.
        ;(function(co, fn, trigger, grid) {
        	let msg = fn.msg;
        	
        	fn.judgment = function() {
        		let invoiceGrid = grid.context[grid.id.grid];
                let checkedRows = invoiceGrid.getCheckedRows();
                
                /* invoiceGrid.disableRowCheck(1);
        		console.log('judgmentBtn');
        		console.log('checkedRows', checkedRows); */
        	}
        	
        	fn.issue = function() {
                console.log('issueBtn');
            }
        	
        	fn.init = function() {
                console.log('initBtn');
            }
        	
            fn.search = function() {
            	let data = fn.form.getData();
            	
            	//let params = fn.form.getData();
            	let params = {
            		beginDate: data['beginDate'],
                    endDate: data['endDate'],
                    invoiceNo: data['invoiceNo'],
                    destNationCode: data['destNationCode'],
                    ftaId: data['ftaId'],
                    status: data['status'],
                    customerName: data['customerName'],
                }
                
                grid.api.search(grid.id.grid, params);
            }
            
            fn.delete = function() {
            	let invoiceGrid = grid[grid.id.grid].context;
            	let checkedRows = invoiceGrid.getCheckedRows();
            	
            	if (checkedRows < 1) {
            		msg.alert.info(
                        'no data', 
                        '선택된 데이터가 없습니다.', 
                    );
            		return;
            	}
            	
                msg.confirm.swal(
                    "인보이스 삭제", 
                    "정말 삭제하시겠습니까?", 
                    function(isOk) {
                        if (isOk) {
                        	let opt = {
                                uri: co.uriMap.delete,
                                params: { data : checkedRows }
                            }
                        	
                        	fn.api.save(opt, function(res) {
                        		console.log('delete res', res);
                        		
                        		msg.alert.success(
                                    'success custom title', 
                                    '삭제완료', 
                                );
                            });
                        }
                    }
                );
            }
            
            fn.download = function() {
                grid[grid.id.grid].context.export('csv', {
                    includeHeader: true,
                    fileName: 'INVOICE LIST',
                });              
            }
            
            /* fn.save = function() {
                let sampleGrid = grid[grid.id.grid].context;
                
                //modified rows.
                let rows = sampleGrid.getModifiedRows();
                console.log('ModifiedRows', rows);
                //checked row.
                console.log('Checked row', sampleGrid.getCheckedRows()); 
                
                //grid validation check.
                let v = sampleGrid.validate();
                console.log('v ==> ', v);
                if (v.length > 0) {
                    return;
                }
                
                let opt = {
                    uri : co.uriMap.save,
                    params : { data : rows }
                }
                
                //default 저장 함수 호출.
                //특별한 이유가 없으면 해당 함수 사용.
                fn.api.save(opt, function() {
                    console.log('save callback fnc!!');
                });
            } */
        })(wg.c, wg.f, wg.t, wg.gr);
        
        // 3.event area.
        ;(function(co, fn, trigger, grid) {
            fn.event = function() {
                //wg.t => data-trigger="button" 하위의 id를 가지고 있는 dom이 모두 등록 된다.
                
                //judgment
                $(trigger.button.judgmentBtn).click(function() {
                    fn.judgment();
                });
                
                //delete
                $(trigger.button.deleteBtn).click(function() {
                    fn.delete();
                });
                
                //issue
                $(trigger.button.issueBtn).click(function() {
                    fn.issue();
                });
                
                //download
                $(trigger.button.downloadBtn).click(function() {
                    fn.download();
                });
                
                //search
                $(trigger.button.searchBtn).click(function() {
                    fn.search();
                });
                
                //save
                $(trigger.button.initBtn).click(function() {
                    fn.init();
                });
                
                //move writepage.
                /* $(trigger.button.writeBtn).click(function() {
                    
                    //이동하는 page의 storage 데이터를 삭제 후 이동.
                    //특별한 이유가 없으면 해당 함수 사용.
                    fn.move.page(co.moveMap.write, {});
                });
                 */
                
                /* === grid event === */
                //clear row
                /* $(trigger.button.clearRow).click(function() {
                    grid[grid.id.grid].context.clear();
                });
                //append row
                $(trigger.button.appendRow).click(function() {
                    grid[grid.id.grid].context.appendRow({name: 'addName', age: '20'}, {at: 0});
                });
                //delete row
                $(trigger.button.deleteRow).click(function() {
                    //true : 삭제여부 alert 사용., false : 삭제여부 alert 미사용.
                    grid[grid.id.grid].context.removeCheckedRows(false);  
                });
                //modified row data.
                $(trigger.button.modifiedRow).click(function() {
                    let rows = grid[grid.id.grid].context.getModifiedRows();
                    console.log(rows);
                }); */
            }
            
        })(wg.c, wg.f, wg.t, wg.gr);
    </script>
    <script th:inline="javascript">
        'use strict';
        $(document).ready(() => {
            const co = wg.c;
            const fn = wg.f;
            const grid = wg.gr;
            
            // SET DATAPICKER DATA
            fn.form.setData({
                start_invoiceDate: co.initParams['start_invoiceDate'],
                end_invoiceDate: co.initParams['end_invoiceDate'],
            });
            
            grid.render(grid.id.grid, co.initParams);
            
            // event load.
            fn.event();
        });
    </script>
</th:block>
</html>