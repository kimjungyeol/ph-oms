<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="sample/layouts/default-layout">
<th:block layout:fragment="content">
    <div class="container">
        <h2>Board - list</h2>
        <div class="mt-3" data-trigger="button">
            <a href="javascript:void(0);" class="btn btn-primary" id="searchBtn">Search</a> 
            <a href="javascript:void(0);" class="btn btn-danger"  id="saveBtn">Save</a> 
            <a href="javascript:void(0);" class="btn btn-warning" id="writeBtn">Write</a>
            <a href="javascript:void(0);" class="btn btn-primary" id="tempBtn">temp</a>
        </div>
        
        <div class="mt-3" data-trigger="form">
            <div class="form-floating mb-3">
                <input class="form-control" id="username" name="username" type="text" style="width:500px;">
                <label for="username">User name</label>
            </div>
            <div class="form-floating mb-3">
                <input class="form-control" id="email" name="email" type="email" style="width:500px;">
                <label for="email">Email address</label>
            </div>
        </div>
        
        <h2>Grid 1</h2>
        <div class="mt-2" data-trigger="button">
            <a href="javascript:void(0);" class="btn btn-primary" id="clearRow">Clear Row</a> 
            <a href="javascript:void(0);" class="btn btn-primary" id="appendRow">Append Row</a> 
            <a href="javascript:void(0);" class="btn btn-primary" id="deleteRow">Delete Row</a> 
            <a href="javascript:void(0);" class="btn btn-primary" id="modifiedRow">Modified Row</a> 
        </div>
        <div class="mt-2" id="sampleGrid"></div>
        
        <h2>Grid 2</h2>
        <div class="mt-2" id="testGrid"></div>
    </div>

    <script th:inline="javascript">
        'use strict';
        
        /* 
        [front 개발 표준] 
        1. thymeleaf를 사용하지만 layout 구성용도로만 사용한다.
        2. thymeleaf html 제어는 사용하지 않는다.
        3. script를 사용하여 html을 제어 하도록 한다.
        4. 공통 script를 사용하여 개발 하도록 한다.
        
		[공통 script]
		1. 실행함수 영역 구분.
			- 초기 설정 실행함수 영역.
				: 1.page init area.
				: 기능 설정에 필요한 변수, uri, 기준정보를 세팅한다.
			- 함수 설정 실행함수 영역.
				: 2.function area.
				: 모든 기능 함수를 해당영역에 세팅한다.
			- 이벤트 설정 실행함수 영역.
				: 3.event area.
				: 모든 이벤트 설정을 해당 영역에 세팅한다.
		2. 공통 script global 변수.
			- wg.c (contents)
				: 개발시 사용 될 초기 변수를 설정한다.
			- wg.f (function)
				: 개발시 사용 될 모든 함수를 설정한다.
				: 기본적으로 공통으로 사용하는 함수를 사용한다.
					 api   (defulat transaction management)
					 	: server transaction function.
						 	seerch 
						 		: 공통 조회함수
						 	save 
						 		: 공통 저장함수
						 		: 기본적으로 data-trigger="form" 하위 id가 존재하는 dom의 value를 parameter로 추가한다.
						 		: 전달한 parameter를 추가한다.
						 	saveForm 
						 		: 공통 multipart 저장함수
						 		: file 정보를 parameter로 추가한다.
						 	    : 기본적으로 data-trigger="form" 하위 id가 존재하는 dom의 value를 parameter로 추가한다.
					 		    : 전달한 parameter를 추가한다.
					 move  (page move management)
					 	: 화면 이동시 처리를 위하여 사용.
					 	: 파라메터 전달여부 구분하여 사용.
					 form  (html form data management)
					 	: html 제어를위한 공통 object.
					 msg   (alert, confirm common message mangement)
					 	: 공통 메세지처리 object.
					 popup (layer, window popup management)
					 	: layer popup / window popup 공통 obejct.
			- wg.t (trigger)
				: HTML data-trigger="button" 속성 하위 id가 존재하는 DOM Object를 가지고 있다.
				: 이벤트 영역에서 주로 사용.
			- wg.gr (grid)
				: grid 관련 공통 기능.
		*/ 
	
	
        // 1.page init area.
        ;(function(co, grid) {
            co.initParams = {
            	param1 : 'p1',
            	param2 : 'p2',
            }
            
            co.uriMap = {
        		search : '/sample/board/list/search',
        		save   : '/sample/board/list/save',
            }
            co.moveMap = {
            	write : '/sample/contents/board/board-register',
            }
            
            //grid id 지정.
            //grid 갯수만큼 지정 되어야 함.
            grid.id = {
            	grid  : 'sampleGrid',   //<div class="mt-2" id="sampleGrid"></div>
        		grid2 : 'testGrid',     //<div class="mt-2" id="testGrid"></div>
            }
            
            //grid js include.
            co.require(['./grid/grid-test.js', './grid/grid-sample.js']);
            
        })(wg.c, wg.gr);
        
        // 2.function area.
        ;(function(co, fn, trigger, grid) {
            fn.search = function() {
            	let params = {
                    username : $('#username').val(),
                    email : $('#email').val(),
                    param1 : 'new p1',
                    param2 : 'new p2',
                }
            	
            	//grid 검색.
            	//grid id 정보, 파라메터를 세팅하여 호출.
            	//특별한 이유가 없으면 해당 함수 사용.
                grid.api.search(grid.id.grid, params);
                grid.api.search(grid.id.grid2, params);
            }
            
            fn.save = function() {
            	let sampleGrid = grid[grid.id.grid].context;
            	
            	//modified rows.
            	let rows = sampleGrid.getModifiedRows();
                console.log('ModifiedRows', rows);
                //checked row.
                console.log('Checked row', sampleGrid.getCheckedRows()); 
                
                //grid validation check.
                let v = sampleGrid.validate();
                console.log('v ==> ', v);
                if (v.length > 0) {
	                // TODO swal confirm 창 작업.
	                // error message.
	                return;
                }
                
                let opt = {
               		uri : co.uriMap.save,
               		params : { data : rows }
               	}
                
                //default 저장 함수 호출.
        		//특별한 이유가 없으면 해당 함수 사용.
                fn.api.save(opt, function() {
                    console.log('save callback fnc!!');
                });
            }
        })(wg.c, wg.f, wg.t, wg.gr);
        
        // 3.event area.
        ;(function(co, fn, trigger, grid) {
            fn.event = function() {
            	//wg.t => data-trigger="button" 하위의 id를 가지고 있는 dom이 모두 등록 된다.
            	
            	//search.
            	$(trigger.button.searchBtn).click(function() {
            		fn.search();
                });
            	//save.
            	$(trigger.button.saveBtn).click(function() {
            		fn.save();
                });
            	//move writepage.
                $(trigger.button.writeBtn).click(function() {
                	
                	//이동하는 page의 storage 데이터를 삭제 후 이동.
                	//특별한 이유가 없으면 해당 함수 사용.
                    fn.move.page(co.moveMap.write, {});
                });
            	
            	
                /* === grid event === */
                //clear row
                $(trigger.button.clearRow).click(function() {
                	grid[grid.id.grid].context.clear();
                });
                //append row
                $(trigger.button.appendRow).click(function() {
                	grid[grid.id.grid].context.appendRow({name: 'addName', age: '20'}, {at: 0});
                });
                //delete row
                $(trigger.button.deleteRow).click(function() {
                	//true : 삭제여부 alert 사용., false : 삭제여부 alert 미사용.
                	grid[grid.id.grid].context.removeCheckedRows(false);  
                });
                //modified row data.
                $(trigger.button.modifiedRow).click(function() {
                	let rows = grid[grid.id.grid].context.getModifiedRows();
                	console.log(rows);
                });
            }
            
        })(wg.c, wg.f, wg.t, wg.gr);
    </script>
    <script th:inline="javascript">
        'use strict';
        $(document).ready(() => {
            const co = wg.c;
            const fn = wg.f;
            const grid = wg.gr;
            
            // sampleGrid load.
            grid.render(grid.id.grid, co.initParams);
            
            // testGrid load.
            grid.render(grid.id.grid2, {
                param1 : 'testparam1',
                param2 : 'testparam2',
            });
            
            // event load.
            fn.event();  
        });
    </script>
</th:block>
</html>